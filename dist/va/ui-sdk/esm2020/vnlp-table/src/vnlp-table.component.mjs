import { Component, Input, EventEmitter, Output } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "@em-and-ai/ui-sdk/vnlp-checkbox";
import * as i3 from "@angular/common";
export class VnlpTableComponent {
    constructor(router, route) {
        this.router = router;
        this.route = route;
        this.columns = [];
        this.dataTable = [];
        this.dataTableChange = new EventEmitter();
        // page status
        this.pageOptions = {
            currentPage: 1,
            pageSize: 0,
            totalRecord: 0,
            sort: 1,
            sortField: '',
            pagination: true,
        };
        this.editable = true;
        this.deletable = true;
        this.selectable = false;
        this.selectKey = '';
        this.key = Date.now().toString(36);
        this.onPageOptionsChange = new EventEmitter();
        this.onDeleteRecord = new EventEmitter();
        this.onEditRecord = new EventEmitter();
        this.lastPage = 0;
        this.pageStatusSubject = new Subject();
        this.checkedAllSubject = new Subject();
        this.checkedAll = false;
    }
    ngOnInit() {
        if (this.pageOptions?.pagination === undefined) {
            this.pageOptions.pagination = true;
        }
        this.pageStatusSubject.pipe(debounceTime(300)).subscribe(() => {
            this.syncPageOptionsWithUrl();
        });
        this.checkedAllSubject.subscribe(() => {
            this.checkedAll = !this.checkedAll;
            this.dataTable = this.dataTable.map((data) => {
                data[this.selectKey] = this.checkedAll;
                return data;
            });
        });
        this.lastPage = Math.ceil(this.pageOptions.totalRecord / this.pageOptions.pageSize);
    }
    handleCheckedAll() {
        this.checkedAllSubject.next(1);
    }
    handleShowCheckedAll() {
        this.checkedAll = this.dataTable.every((data) => data[this.selectKey]);
    }
    syncPageOptionsWithUrl() {
        this.router.navigate([], {
            relativeTo: this.route,
            queryParams: {
                currentPage: this.pageOptions.currentPage,
                sortField: this.pageOptions.sortField,
                sort: this.pageOptions.sort,
            },
            queryParamsHandling: 'merge',
        });
        this.onPageOptionsChange.emit({
            currentPage: this.pageOptions.currentPage,
            sortField: this.pageOptions.sortField,
            sort: this.pageOptions.sort,
        });
    }
    get pages() {
        let start = 1;
        let end = Math.min(this.lastPage, 5);
        if (this.lastPage > 5) {
            if (this.pageOptions.currentPage <= 3) {
                end = 5;
            }
            else if (this.pageOptions.currentPage >= this.lastPage - 2) {
                start = this.lastPage - 4;
                end = this.lastPage;
            }
            else {
                start = this.pageOptions.currentPage - 2;
                end = this.pageOptions.currentPage + 2;
            }
        }
        if (this.pageOptions.totalRecord === 0) {
            start = 1;
            end = 1;
        }
        const pages = [];
        for (let i = start; i <= end; i++) {
            pages.push(i);
        }
        return pages;
    }
    prevPage() {
        this.goToPage(this.pageOptions.currentPage - 1);
    }
    nextPage() {
        this.goToPage(this.pageOptions.currentPage + 1);
    }
    goToLastPage() {
        this.goToPage(this.lastPage);
    }
    goToFirstPage() {
        this.goToPage(1);
    }
    goToPage(page) {
        if (page < 1 || page > this.lastPage)
            return;
        if (page === this.pageOptions.currentPage)
            return;
        this.pageOptions.currentPage = page;
        this.pageStatusSubject.next(page);
    }
    getDisplayText() {
        if (this.pageOptions.totalRecord === 0) {
            return 'Showing 0 to 0 of 0 entries';
        }
        const start = (this.pageOptions.currentPage - 1) * this.pageOptions.pageSize + 1;
        const end = start - 1 + this.pageOptions.pageSize;
        const total = this.pageOptions.totalRecord;
        return `Showing ${start} to ${end} of ${total} entries`;
    }
    handleSort(key) {
        this.pageOptions.sortField = key;
        this.pageOptions.sort = this.pageOptions.sort
            ? this.pageOptions.sort * -1
            : 1;
        this.syncPageOptionsWithUrl();
    }
    handleDeleteRecord(id) {
        this.onDeleteRecord.emit(id);
    }
    handleEditRecord(id) {
        this.onEditRecord.emit(id);
    }
}
VnlpTableComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: VnlpTableComponent, deps: [{ token: i1.Router }, { token: i1.ActivatedRoute }], target: i0.ɵɵFactoryTarget.Component });
VnlpTableComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.12", type: VnlpTableComponent, selector: "vnlp-table", inputs: { columns: "columns", dataTable: "dataTable", pageOptions: "pageOptions", editable: "editable", deletable: "deletable", selectable: "selectable", selectKey: "selectKey", key: "key" }, outputs: { dataTableChange: "dataTableChange", onPageOptionsChange: "onPageOptionsChange", onDeleteRecord: "onDeleteRecord", onEditRecord: "onEditRecord" }, ngImport: i0, template: "<div class=\"vnlp-table-container\">\r\n  <div class=\"loading\"></div>\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th class=\"check-all-record\" *ngIf=\"selectable\">\r\n          <vnlp-checkbox\r\n            [checked]=\"checkedAll\"\r\n            (onChange)=\"handleCheckedAll()\"\r\n          ></vnlp-checkbox>\r\n        </th>\r\n        <th\r\n          *ngFor=\"let col of columns\"\r\n          (click)=\"col.sortable && handleSort(col.key)\"\r\n        >\r\n          <i\r\n            *ngIf=\"col.sortable\"\r\n            [ngClass]=\"{\r\n              'cursor-pointer icon icon-vnlp-icon-upanddown-line transition-all ease-in-out duration-200 rotate-180': true,\r\n              'icon-vnlp-icon-arrow-up-line': pageOptions.sortField === col.key,\r\n              'rotate-180':\r\n                pageOptions.sortField === col.key && pageOptions.sort === -1\r\n            }\"\r\n          ></i>\r\n          <span>{{ col.title }}</span>\r\n        </th>\r\n        <th *ngIf=\"columns.length\" class=\"action-header\">Action</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody *ngIf=\"dataTable.length; else emptyData\">\r\n      <tr *ngFor=\"let item of dataTable\">\r\n        <td *ngIf=\"selectable\">\r\n          <vnlp-checkbox\r\n            [(checked)]=\"item[selectKey]\"\r\n            (onChange)=\"handleShowCheckedAll()\"\r\n          ></vnlp-checkbox>\r\n        </td>\r\n        <td *ngFor=\"let col of columns\">{{ item[col.key] }}</td>\r\n        <td class=\"action-col\">\r\n          <div class=\"flex justify-end\">\r\n            <i\r\n              *ngIf=\"deletable\"\r\n              class=\"icon icon-vnlp-icon-trash-linear hidden\"\r\n              (click)=\"handleDeleteRecord(item[key])\"\r\n            ></i>\r\n            <i\r\n              *ngIf=\"editable\"\r\n              class=\"icon icon-vnlp-icon-magicpen-linear hidden\"\r\n              (click)=\"handleEditRecord(item[key])\"\r\n            ></i>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n    <ng-template #emptyData>\r\n      <tr>\r\n        <td [attr.colspan]=\"columns.length + 2\" class=\"empty-data\">\r\n          <span>No data</span>\r\n          <p>Create first data now!</p>\r\n          <div class=\"create-button inline-flex items-center\">\r\n            <i class=\"icon icon-vnlp-icon-add-linear\"></i>\r\n            <span>Create</span>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    </ng-template>\r\n  </table>\r\n  <div *ngIf=\"pageOptions.pagination\" class=\"table-footer\">\r\n    <p class=\"counter\">{{ getDisplayText() }}</p>\r\n    <div class=\"paginator\">\r\n      <button\r\n        [disabled]=\"pageOptions.currentPage == 1\"\r\n        (click)=\"prevPage()\"\r\n        class=\"paginator-prev icon icon-vnlp-icon-arrow-left-2-linear\"\r\n      ></button>\r\n      <ng-container *ngFor=\"let pageNumber of pages\">\r\n        <button\r\n          class=\"page-number\"\r\n          [class.active]=\"pageNumber == pageOptions.currentPage\"\r\n          (click)=\"goToPage(pageNumber)\"\r\n        >\r\n          {{ pageNumber }}\r\n        </button>\r\n      </ng-container>\r\n      <button\r\n        [disabled]=\"pageOptions.currentPage == lastPage || lastPage === 0\"\r\n        (click)=\"nextPage()\"\r\n        class=\"paginator-next icon icon-vnlp-icon-arrow-right-3-linear\"\r\n      ></button>\r\n    </div>\r\n  </div>\r\n</div>\r\n", styles: [".vnlp-table-container{border-radius:12px;overflow:hidden;box-shadow:0 0 1px 1px #e6e8ec;background-color:#fff;position:relative}.vnlp-table-container table{width:100%;border-collapse:collapse;font-size:14px;background-color:#fff}.vnlp-table-container table tbody tr{max-height:44px}.vnlp-table-container table tbody tr:hover{background-color:#f6f8fa}.vnlp-table-container table tbody tr:hover .icon{display:block}.vnlp-table-container table th,.vnlp-table-container table td{border-bottom:1px solid #e6e8ec;text-align:left}.vnlp-table-container table th.empty-data,.vnlp-table-container table td.empty-data{text-align:center;padding-top:40px}.vnlp-table-container table th.empty-data span,.vnlp-table-container table td.empty-data span{font-size:16px;font-weight:700;color:#23262f}.vnlp-table-container table th.empty-data p,.vnlp-table-container table td.empty-data p{font-size:14px;color:#b1b5c3}.vnlp-table-container table th.empty-data .create-button,.vnlp-table-container table td.empty-data .create-button{cursor:pointer}.vnlp-table-container table th.empty-data .create-button i,.vnlp-table-container table th.empty-data .create-button span,.vnlp-table-container table td.empty-data .create-button i,.vnlp-table-container table td.empty-data .create-button span{color:#007df9}.vnlp-table-container table th{padding:16px;color:#777e90;font-size:14px;font-weight:500;cursor:pointer;-webkit-user-select:none;user-select:none}.vnlp-table-container table th.action-header{text-align:end}.vnlp-table-container table th.check-all-record{width:56px}.vnlp-table-container table th:hover{background-color:#f6f8fa}.vnlp-table-container table td{padding:10px 16px}.vnlp-table-container table td.action-col{width:100px;padding:0 16px}.vnlp-table-container table td .icon{font-size:18px;cursor:pointer}.vnlp-table-container .table-footer{display:flex;align-items:center;justify-content:space-between;padding:24px 20px}.vnlp-table-container .table-footer .counter{font-size:14px;color:#777e90}.vnlp-table-container .table-footer .paginator{display:flex;justify-content:center;align-items:center;gap:10px}.vnlp-table-container .table-footer .paginator .paginator-prev,.vnlp-table-container .table-footer .paginator .paginator-next,.vnlp-table-container .table-footer .paginator .page-number{width:32px;height:32px;border:1px solid #e6e8ec;border-radius:4px;font-size:14px}.vnlp-table-container .table-footer .paginator .paginator-prev:hover,.vnlp-table-container .table-footer .paginator .paginator-next:hover,.vnlp-table-container .table-footer .paginator .page-number:hover{border:1px solid #007df9}.vnlp-table-container .table-footer .paginator .paginator-prev:disabled,.vnlp-table-container .table-footer .paginator .paginator-next:disabled,.vnlp-table-container .table-footer .paginator .page-number:disabled{cursor:not-allowed;border:1px solid #e6e8ec}.vnlp-table-container .table-footer .paginator .page-number.active{background-color:#007df9;color:#fff}\n"], dependencies: [{ kind: "component", type: i2.VnlpCheckboxComponent, selector: "vnlp-checkbox", inputs: ["label", "name", "disabled", "checked", "labelPosition", "isShowInList", "isShowDivider"], outputs: ["checkedChange", "onChange"] }, { kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: VnlpTableComponent, decorators: [{
            type: Component,
            args: [{ selector: 'vnlp-table', template: "<div class=\"vnlp-table-container\">\r\n  <div class=\"loading\"></div>\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th class=\"check-all-record\" *ngIf=\"selectable\">\r\n          <vnlp-checkbox\r\n            [checked]=\"checkedAll\"\r\n            (onChange)=\"handleCheckedAll()\"\r\n          ></vnlp-checkbox>\r\n        </th>\r\n        <th\r\n          *ngFor=\"let col of columns\"\r\n          (click)=\"col.sortable && handleSort(col.key)\"\r\n        >\r\n          <i\r\n            *ngIf=\"col.sortable\"\r\n            [ngClass]=\"{\r\n              'cursor-pointer icon icon-vnlp-icon-upanddown-line transition-all ease-in-out duration-200 rotate-180': true,\r\n              'icon-vnlp-icon-arrow-up-line': pageOptions.sortField === col.key,\r\n              'rotate-180':\r\n                pageOptions.sortField === col.key && pageOptions.sort === -1\r\n            }\"\r\n          ></i>\r\n          <span>{{ col.title }}</span>\r\n        </th>\r\n        <th *ngIf=\"columns.length\" class=\"action-header\">Action</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody *ngIf=\"dataTable.length; else emptyData\">\r\n      <tr *ngFor=\"let item of dataTable\">\r\n        <td *ngIf=\"selectable\">\r\n          <vnlp-checkbox\r\n            [(checked)]=\"item[selectKey]\"\r\n            (onChange)=\"handleShowCheckedAll()\"\r\n          ></vnlp-checkbox>\r\n        </td>\r\n        <td *ngFor=\"let col of columns\">{{ item[col.key] }}</td>\r\n        <td class=\"action-col\">\r\n          <div class=\"flex justify-end\">\r\n            <i\r\n              *ngIf=\"deletable\"\r\n              class=\"icon icon-vnlp-icon-trash-linear hidden\"\r\n              (click)=\"handleDeleteRecord(item[key])\"\r\n            ></i>\r\n            <i\r\n              *ngIf=\"editable\"\r\n              class=\"icon icon-vnlp-icon-magicpen-linear hidden\"\r\n              (click)=\"handleEditRecord(item[key])\"\r\n            ></i>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n    <ng-template #emptyData>\r\n      <tr>\r\n        <td [attr.colspan]=\"columns.length + 2\" class=\"empty-data\">\r\n          <span>No data</span>\r\n          <p>Create first data now!</p>\r\n          <div class=\"create-button inline-flex items-center\">\r\n            <i class=\"icon icon-vnlp-icon-add-linear\"></i>\r\n            <span>Create</span>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    </ng-template>\r\n  </table>\r\n  <div *ngIf=\"pageOptions.pagination\" class=\"table-footer\">\r\n    <p class=\"counter\">{{ getDisplayText() }}</p>\r\n    <div class=\"paginator\">\r\n      <button\r\n        [disabled]=\"pageOptions.currentPage == 1\"\r\n        (click)=\"prevPage()\"\r\n        class=\"paginator-prev icon icon-vnlp-icon-arrow-left-2-linear\"\r\n      ></button>\r\n      <ng-container *ngFor=\"let pageNumber of pages\">\r\n        <button\r\n          class=\"page-number\"\r\n          [class.active]=\"pageNumber == pageOptions.currentPage\"\r\n          (click)=\"goToPage(pageNumber)\"\r\n        >\r\n          {{ pageNumber }}\r\n        </button>\r\n      </ng-container>\r\n      <button\r\n        [disabled]=\"pageOptions.currentPage == lastPage || lastPage === 0\"\r\n        (click)=\"nextPage()\"\r\n        class=\"paginator-next icon icon-vnlp-icon-arrow-right-3-linear\"\r\n      ></button>\r\n    </div>\r\n  </div>\r\n</div>\r\n", styles: [".vnlp-table-container{border-radius:12px;overflow:hidden;box-shadow:0 0 1px 1px #e6e8ec;background-color:#fff;position:relative}.vnlp-table-container table{width:100%;border-collapse:collapse;font-size:14px;background-color:#fff}.vnlp-table-container table tbody tr{max-height:44px}.vnlp-table-container table tbody tr:hover{background-color:#f6f8fa}.vnlp-table-container table tbody tr:hover .icon{display:block}.vnlp-table-container table th,.vnlp-table-container table td{border-bottom:1px solid #e6e8ec;text-align:left}.vnlp-table-container table th.empty-data,.vnlp-table-container table td.empty-data{text-align:center;padding-top:40px}.vnlp-table-container table th.empty-data span,.vnlp-table-container table td.empty-data span{font-size:16px;font-weight:700;color:#23262f}.vnlp-table-container table th.empty-data p,.vnlp-table-container table td.empty-data p{font-size:14px;color:#b1b5c3}.vnlp-table-container table th.empty-data .create-button,.vnlp-table-container table td.empty-data .create-button{cursor:pointer}.vnlp-table-container table th.empty-data .create-button i,.vnlp-table-container table th.empty-data .create-button span,.vnlp-table-container table td.empty-data .create-button i,.vnlp-table-container table td.empty-data .create-button span{color:#007df9}.vnlp-table-container table th{padding:16px;color:#777e90;font-size:14px;font-weight:500;cursor:pointer;-webkit-user-select:none;user-select:none}.vnlp-table-container table th.action-header{text-align:end}.vnlp-table-container table th.check-all-record{width:56px}.vnlp-table-container table th:hover{background-color:#f6f8fa}.vnlp-table-container table td{padding:10px 16px}.vnlp-table-container table td.action-col{width:100px;padding:0 16px}.vnlp-table-container table td .icon{font-size:18px;cursor:pointer}.vnlp-table-container .table-footer{display:flex;align-items:center;justify-content:space-between;padding:24px 20px}.vnlp-table-container .table-footer .counter{font-size:14px;color:#777e90}.vnlp-table-container .table-footer .paginator{display:flex;justify-content:center;align-items:center;gap:10px}.vnlp-table-container .table-footer .paginator .paginator-prev,.vnlp-table-container .table-footer .paginator .paginator-next,.vnlp-table-container .table-footer .paginator .page-number{width:32px;height:32px;border:1px solid #e6e8ec;border-radius:4px;font-size:14px}.vnlp-table-container .table-footer .paginator .paginator-prev:hover,.vnlp-table-container .table-footer .paginator .paginator-next:hover,.vnlp-table-container .table-footer .paginator .page-number:hover{border:1px solid #007df9}.vnlp-table-container .table-footer .paginator .paginator-prev:disabled,.vnlp-table-container .table-footer .paginator .paginator-next:disabled,.vnlp-table-container .table-footer .paginator .page-number:disabled{cursor:not-allowed;border:1px solid #e6e8ec}.vnlp-table-container .table-footer .paginator .page-number.active{background-color:#007df9;color:#fff}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.Router }, { type: i1.ActivatedRoute }]; }, propDecorators: { columns: [{
                type: Input
            }], dataTable: [{
                type: Input
            }], dataTableChange: [{
                type: Output
            }], pageOptions: [{
                type: Input
            }], editable: [{
                type: Input
            }], deletable: [{
                type: Input
            }], selectable: [{
                type: Input
            }], selectKey: [{
                type: Input
            }], key: [{
                type: Input
            }], onPageOptionsChange: [{
                type: Output
            }], onDeleteRecord: [{
                type: Output
            }], onEditRecord: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidm5scC10YWJsZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy92YS91aS1zZGsvdm5scC10YWJsZS9zcmMvdm5scC10YWJsZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy92YS91aS1zZGsvdm5scC10YWJsZS9zcmMvdm5scC10YWJsZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxZQUFZLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRS9FLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7OztBQU85QyxNQUFNLE9BQU8sa0JBQWtCO0lBcUM3QixZQUFvQixNQUFjLEVBQVUsS0FBcUI7UUFBN0MsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBcEN4RCxZQUFPLEdBQXlELEVBQUUsQ0FBQztRQUNuRSxjQUFTLEdBQVEsRUFBRSxDQUFDO1FBQ25CLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUvQyxjQUFjO1FBQ0wsZ0JBQVcsR0FPaEI7WUFDRixXQUFXLEVBQUUsQ0FBQztZQUNkLFFBQVEsRUFBRSxDQUFDO1lBQ1gsV0FBVyxFQUFFLENBQUM7WUFDZCxJQUFJLEVBQUUsQ0FBQztZQUNQLFNBQVMsRUFBRSxFQUFFO1lBQ2IsVUFBVSxFQUFFLElBQUk7U0FDakIsQ0FBQztRQUVPLGFBQVEsR0FBWSxJQUFJLENBQUM7UUFDekIsY0FBUyxHQUFZLElBQUksQ0FBQztRQUMxQixlQUFVLEdBQVksS0FBSyxDQUFDO1FBQzVCLGNBQVMsR0FBVyxFQUFFLENBQUM7UUFDdkIsUUFBRyxHQUFRLElBQUksQ0FBQyxHQUFH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LENBQUMsQ0FBQyxDQUFDO1FBRU4sSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVELGtCQUFrQixDQUFDLEVBQVU7UUFDM0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELGdCQUFnQixDQUFDLEVBQVU7UUFDekIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0IsQ0FBQzs7Z0hBdktVLGtCQUFrQjtvR0FBbEIsa0JBQWtCLCtZQ1YvQixnMkdBNEZBOzRGRGxGYSxrQkFBa0I7a0JBTDlCLFNBQVM7K0JBQ0UsWUFBWTswSEFLYixPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDSSxlQUFlO3NCQUF4QixNQUFNO2dCQUdFLFdBQVc7c0JBQW5CLEtBQUs7Z0JBZ0JHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0csR0FBRztzQkFBWCxLQUFLO2dCQUVJLG1CQUFtQjtzQkFBNUIsTUFBTTtnQkFDRyxjQUFjO3NCQUF2QixNQUFNO2dCQUNHLFlBQVk7c0JBQXJCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAndm5scC10YWJsZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3ZubHAtdGFibGUuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3ZubHAtdGFibGUuY29tcG9uZW50LnNjc3MnXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIFZubHBUYWJsZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgQElucHV0KCkgY29sdW1uczogeyB0aXRsZTogc3RyaW5nOyBrZXk6IHN0cmluZzsgc29ydGFibGU/OiBib29sZWFuIH1bXSA9IFtdO1xyXG4gIEBJbnB1dCgpIGRhdGFUYWJsZTogYW55ID0gW107XHJcbiAgQE91dHB1dCgpIGRhdGFUYWJsZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgLy8gcGFnZSBzdGF0dXNcclxuICBASW5wdXQoKSBwYWdlT3B0aW9uczoge1xyXG4gICAgY3VycmVudFBhZ2U6IG51bWJlcjtcclxuICAgIHBhZ2VTaXplOiBudW1iZXI7XHJcbiAgICB0b3RhbFJlY29yZDogbnVtYmVyO1xyXG4gICAgc29ydD86IGFueTtcclxuICAgIHNvcnRGaWVsZD86IHN0cmluZztcclxuICAgIHBhZ2luYXRpb24/OiBib29sZWFuO1xyXG4gIH0gPSB7XHJcbiAgICBjdXJyZW50UGFnZTogMSxcclxuICAgIHBhZ2VTaXplOiAwLFxyXG4gICAgdG90YWxSZWNvcmQ6IDAsXHJcbiAgICBzb3J0OiAxLFxyXG4gICAgc29ydEZpZWxkOiAnJyxcclxuICAgIHBhZ2luYXRpb246IHRydWUsXHJcbiAgfTtcclxuXHJcbiAgQElucHV0KCkgZWRpdGFibGU6IGJvb2xlYW4gPSB0cnVlO1xyXG4gIEBJbnB1dCgpIGRlbGV0YWJsZTogYm9vbGVhbiA9IHRydWU7XHJcbiAgQElucHV0KCkgc2VsZWN0YWJsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHNlbGVjdEtleTogc3RyaW5nID0gJyc7XHJcbiAgQElucHV0KCkga2V5OiBhbnkgPSBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KTtcclxuXHJcbiAgQE91dHB1dCgpIG9uUGFnZU9wdGlvbnNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIG9uRGVsZXRlUmVjb3JkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBvbkVkaXRSZWNvcmQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIGxhc3RQYWdlOiBudW1iZXIgPSAwO1xyXG4gIHBhZ2VTdGF0dXNTdWJqZWN0ID0gbmV3IFN1YmplY3Q8bnVtYmVyPigpO1xyXG4gIGNoZWNrZWRBbGxTdWJqZWN0ID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIGNoZWNrZWRBbGwgPSBmYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUpIHt9XHJcblxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMucGFnZU9wdGlvbnM/LnBhZ2luYXRpb24gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLnBhZ2VPcHRpb25zLnBhZ2luYXRpb24gPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucGFnZVN0YXR1c1N1YmplY3QucGlwZShkZWJvdW5jZVRpbWUoMzAwKSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy5zeW5jUGFnZU9wdGlvbnNXaXRoVXJsKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmNoZWNrZWRBbGxTdWJqZWN0LnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2hlY2tlZEFsbCA9ICF0aGlzLmNoZWNrZWRBbGw7XHJcbiAgICAgIHRoaXMuZGF0YVRhYmxlID0gdGhpcy5kYXRhVGFibGUubWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBkYXRhW3RoaXMuc2VsZWN0S2V5XSA9IHRoaXMuY2hlY2tlZEFsbDtcclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmxhc3RQYWdlID0gTWF0aC5jZWlsKFxyXG4gICAgICB0aGlzLnBhZ2VPcHRpb25zLnRvdGFsUmVjb3JkIC8gdGhpcy5wYWdlT3B0aW9ucy5wYWdlU2l6ZVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGhhbmRsZUNoZWNrZWRBbGwoKSB7XHJcbiAgICB0aGlzLmNoZWNrZWRBbGxTdWJqZWN0Lm5leHQoMSk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVTaG93Q2hlY2tlZEFsbCgpIHtcclxuICAgIHRoaXMuY2hlY2tlZEFsbCA9IHRoaXMuZGF0YVRhYmxlLmV2ZXJ5KChkYXRhOiBhbnkpID0+IGRhdGFbdGhpcy5zZWxlY3RLZXldKTtcclxuICB9XHJcblxyXG4gIHN5bmNQYWdlT3B0aW9uc1dpdGhVcmwoKSB7XHJcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXSwge1xyXG4gICAgICByZWxhdGl2ZVRvOiB0aGlzLnJvdXRlLFxyXG4gICAgICBxdWVyeVBhcmFtczoge1xyXG4gICAgICAgIGN1cnJlbnRQYWdlOiB0aGlzLnBhZ2VPcHRpb25zLmN1cnJlbnRQYWdlLFxyXG4gICAgICAgIHNvcnRGaWVsZDogdGhpcy5wYWdlT3B0aW9ucy5zb3J0RmllbGQsXHJcbiAgICAgICAgc29ydDogdGhpcy5wYWdlT3B0aW9ucy5zb3J0LFxyXG4gICAgICB9LFxyXG4gICAgICBxdWVyeVBhcmFtc0hhbmRsaW5nOiAnbWVyZ2UnLFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5vblBhZ2VPcHRpb25zQ2hhbmdlLmVtaXQoe1xyXG4gICAgICBjdXJyZW50UGFnZTogdGhpcy5wYWdlT3B0aW9ucy5jdXJyZW50UGFnZSxcclxuICAgICAgc29ydEZpZWxkOiB0aGlzLnBhZ2VPcHRpb25zLnNvcnRGaWVsZCxcclxuICAgICAgc29ydDogdGhpcy5wYWdlT3B0aW9ucy5zb3J0LFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXQgcGFnZXMoKTogbnVtYmVyW10ge1xyXG4gICAgbGV0IHN0YXJ0ID0gMTtcclxuICAgIGxldCBlbmQgPSBNYXRoLm1pbih0aGlzLmxhc3RQYWdlLCA1KTtcclxuXHJcbiAgICBpZiAodGhpcy5sYXN0UGFnZSA+IDUpIHtcclxuICAgICAgaWYgKHRoaXMucGFnZU9wdGlvbnMuY3VycmVudFBhZ2UgPD0gMykge1xyXG4gICAgICAgIGVuZCA9IDU7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5wYWdlT3B0aW9ucy5jdXJyZW50UGFnZSA+PSB0aGlzLmxhc3RQYWdlIC0gMikge1xyXG4gICAgICAgIHN0YXJ0ID0gdGhpcy5sYXN0UGFnZSAtIDQ7XHJcbiAgICAgICAgZW5kID0gdGhpcy5sYXN0UGFnZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzdGFydCA9IHRoaXMucGFnZU9wdGlvbnMuY3VycmVudFBhZ2UgLSAyO1xyXG4gICAgICAgIGVuZCA9IHRoaXMucGFnZU9wdGlvbnMuY3VycmVudFBhZ2UgKyAyO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMucGFnZU9wdGlvbnMudG90YWxSZWNvcmQgPT09IDApIHtcclxuICAgICAgc3RhcnQgPSAxO1xyXG4gICAgICBlbmQgPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBhZ2VzID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpKyspIHtcclxuICAgICAgcGFnZXMucHVzaChpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcGFnZXM7XHJcbiAgfVxyXG5cclxuICBwcmV2UGFnZSgpIHtcclxuICAgIHRoaXMuZ29Ub1BhZ2UodGhpcy5wYWdlT3B0aW9ucy5jdXJyZW50UGFnZSAtIDEpO1xyXG4gIH1cclxuXHJcbiAgbmV4dFBhZ2UoKSB7XHJcbiAgICB0aGlzLmdvVG9QYWdlKHRoaXMucGFnZU9wdGlvbnMuY3VycmVudFBhZ2UgKyAxKTtcclxuICB9XHJcblxyXG4gIGdvVG9MYXN0UGFnZSgpIHtcclxuICAgIHRoaXMuZ29Ub1BhZ2UodGhpcy5sYXN0UGFnZSk7XHJcbiAgfVxyXG5cclxuICBnb1RvRmlyc3RQYWdlKCkge1xyXG4gICAgdGhpcy5nb1RvUGFnZSgxKTtcclxuICB9XHJcblxyXG4gIGdvVG9QYWdlKHBhZ2U6IG51bWJlcikge1xyXG4gICAgaWYgKHBhZ2UgPCAxIHx8IHBhZ2UgPiB0aGlzLmxhc3RQYWdlKSByZXR1cm47XHJcbiAgICBpZiAocGFnZSA9PT0gdGhpcy5wYWdlT3B0aW9ucy5jdXJyZW50UGFnZSkgcmV0dXJuO1xyXG4gICAgdGhpcy5wYWdlT3B0aW9ucy5jdXJyZW50UGFnZSA9IHBhZ2U7XHJcbiAgICB0aGlzLnBhZ2VTdGF0dXNTdWJqZWN0Lm5leHQocGFnZSk7XHJcbiAgfVxyXG5cclxuICBnZXREaXNwbGF5VGV4dCgpIHtcclxuICAgIGlmICh0aGlzLnBhZ2VPcHRpb25zLnRvdGFsUmVjb3JkID09PSAwKSB7XHJcbiAgICAgIHJldHVybiAnU2hvd2luZyAwIHRvIDAgb2YgMCBlbnRyaWVzJztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGFydCA9XHJcbiAgICAgICh0aGlzLnBhZ2VPcHRpb25zLmN1cnJlbnRQYWdlIC0gMSkgKiB0aGlzLnBhZ2VPcHRpb25zLnBhZ2VTaXplICsgMTtcclxuICAgIGNvbnN0IGVuZCA9IHN0YXJ0IC0gMSArIHRoaXMucGFnZU9wdGlvbnMucGFnZVNpemU7XHJcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMucGFnZU9wdGlvbnMudG90YWxSZWNvcmQ7XHJcblxyXG4gICAgcmV0dXJuIGBTaG93aW5nICR7c3RhcnR9IHRvICR7ZW5kfSBvZiAke3RvdGFsfSBlbnRyaWVzYDtcclxuICB9XHJcblxyXG4gIGhhbmRsZVNvcnQoa2V5OiBhbnkpIHtcclxuICAgIHRoaXMucGFnZU9wdGlvbnMuc29ydEZpZWxkID0ga2V5O1xyXG4gICAgdGhpcy5wYWdlT3B0aW9ucy5zb3J0ID0gdGhpcy5wYWdlT3B0aW9ucy5zb3J0XHJcbiAgICAgID8gdGhpcy5wYWdlT3B0aW9ucy5zb3J0ICogLTFcclxuICAgICAgOiAxO1xyXG5cclxuICAgIHRoaXMuc3luY1BhZ2VPcHRpb25zV2l0aFVybCgpO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlRGVsZXRlUmVjb3JkKGlkOiBzdHJpbmcpIHtcclxuICAgIHRoaXMub25EZWxldGVSZWNvcmQuZW1pdChpZCk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVFZGl0UmVjb3JkKGlkOiBzdHJpbmcpIHtcclxuICAgIHRoaXMub25FZGl0UmVjb3JkLmVtaXQoaWQpO1xyXG4gIH1cclxufVxyXG4iLCI8ZGl2IGNsYXNzPVwidm5scC10YWJsZS1jb250YWluZXJcIj5cclxuICA8ZGl2IGNsYXNzPVwibG9hZGluZ1wiPjwvZGl2PlxyXG4gIDx0YWJsZT5cclxuICAgIDx0aGVhZD5cclxuICAgICAgPHRyPlxyXG4gICAgICAgIDx0aCBjbGFzcz1cImNoZWNrLWFsbC1yZWNvcmRcIiAqbmdJZj1cInNlbGVjdGFibGVcIj5cclxuICAgICAgICAgIDx2bmxwLWNoZWNrYm94XHJcbiAgICAgICAgICAgIFtjaGVja2VkXT1cImNoZWNrZWRBbGxcIlxyXG4gICAgICAgICAgICAob25DaGFuZ2UpPVwiaGFuZGxlQ2hlY2tlZEFsbCgpXCJcclxuICAgICAgICAgID48L3ZubHAtY2hlY2tib3g+XHJcbiAgICAgICAgPC90aD5cclxuICAgICAgICA8dGhcclxuICAgICAgICAgICpuZ0Zvcj1cImxldCBjb2wgb2YgY29sdW1uc1wiXHJcbiAgICAgICAgICAoY2xpY2spPVwiY29sLnNvcnRhYmxlICYmIGhhbmRsZVNvcnQoY29sLmtleSlcIlxyXG4gICAgICAgID5cclxuICAgICAgICAgIDxpXHJcbiAgICAgICAgICAgICpuZ0lmPVwiY29sLnNvcnRhYmxlXCJcclxuICAgICAgICAgICAgW25nQ2xhc3NdPVwie1xyXG4gICAgICAgICAgICAgICdjdXJzb3ItcG9pbnRlciBpY29uIGljb24tdm5scC1pY29uLXVwYW5kZG93bi1saW5lIHRyYW5zaXRpb24tYWxsIGVhc2UtaW4tb3V0IGR1cmF0aW9uLTIwMCByb3RhdGUtMTgwJzogdHJ1ZSxcclxuICAgICAgICAgICAgICAnaWNvbi12bmxwLWljb24tYXJyb3ctdXAtbGluZSc6IHBhZ2VPcHRpb25zLnNvcnRGaWVsZCA9PT0gY29sLmtleSxcclxuICAgICAgICAgICAgICAncm90YXRlLTE4MCc6XHJcbiAgICAgICAgICAgICAgICBwYWdlT3B0aW9ucy5zb3J0RmllbGQgPT09IGNvbC5rZXkgJiYgcGFnZU9wdGlvbnMuc29ydCA9PT0gLTFcclxuICAgICAgICAgICAgfVwiXHJcbiAgICAgICAgICA+PC9pPlxyXG4gICAgICAgICAgPHNwYW4+e3sgY29sLnRpdGxlIH19PC9zcGFuPlxyXG4gICAgICAgIDwvdGg+XHJcbiAgICAgICAgPHRoICpuZ0lmPVwiY29sdW1ucy5sZW5ndGhcIiBjbGFzcz1cImFjdGlvbi1oZWFkZXJcIj5BY3Rpb248L3RoPlxyXG4gICAgICA8L3RyPlxyXG4gICAgPC90aGVhZD5cclxuICAgIDx0Ym9keSAqbmdJZj1cImRhdGFUYWJsZS5sZW5ndGg7IGVsc2UgZW1wdHlEYXRhXCI+XHJcbiAgICAgIDx0ciAqbmdGb3I9XCJsZXQgaXRlbSBvZiBkYXRhVGFibGVcIj5cclxuICAgICAgICA8dGQgKm5nSWY9XCJzZWxlY3RhYmxlXCI+XHJcbiAgICAgICAgICA8dm5scC1jaGVja2JveFxyXG4gICAgICAgICAgICBbKGNoZWNrZWQpXT1cIml0ZW1bc2VsZWN0S2V5XVwiXHJcbiAgICAgICAgICAgIChvbkNoYW5nZSk9XCJoYW5kbGVTaG93Q2hlY2tlZEFsbCgpXCJcclxuICAgICAgICAgID48L3ZubHAtY2hlY2tib3g+XHJcbiAgICAgICAgPC90ZD5cclxuICAgICAgICA8dGQgKm5nRm9yPVwibGV0IGNvbCBvZiBjb2x1bW5zXCI+e3sgaXRlbVtjb2wua2V5XSB9fTwvdGQ+XHJcbiAgICAgICAgPHRkIGNsYXNzPVwiYWN0aW9uLWNvbFwiPlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImZsZXgganVzdGlmeS1lbmRcIj5cclxuICAgICAgICAgICAgPGlcclxuICAgICAgICAgICAgICAqbmdJZj1cImRlbGV0YWJsZVwiXHJcbiAgICAgICAgICAgICAgY2xhc3M9XCJpY29uIGljb24tdm5scC1pY29uLXRyYXNoLWxpbmVhciBoaWRkZW5cIlxyXG4gICAgICAgICAgICAgIChjbGljayk9XCJoYW5kbGVEZWxldGVSZWNvcmQoaXRlbVtrZXldKVwiXHJcbiAgICAgICAgICAgID48L2k+XHJcbiAgICAgICAgICAgIDxpXHJcbiAgICAgICAgICAgICAgKm5nSWY9XCJlZGl0YWJsZVwiXHJcbiAgICAgICAgICAgICAgY2xhc3M9XCJpY29uIGljb24tdm5scC1pY29uLW1hZ2ljcGVuLWxpbmVhciBoaWRkZW5cIlxyXG4gICAgICAgICAgICAgIChjbGljayk9XCJoYW5kbGVFZGl0UmVjb3JkKGl0ZW1ba2V5XSlcIlxyXG4gICAgICAgICAgICA+PC9pPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC90ZD5cclxuICAgICAgPC90cj5cclxuICAgIDwvdGJvZHk+XHJcbiAgICA8bmctdGVtcGxhdGUgI2VtcHR5RGF0YT5cclxuICAgICAgPHRyPlxyXG4gICAgICAgIDx0ZCBbYXR0ci5jb2xzcGFuXT1cImNvbHVtbnMubGVuZ3RoICsgMlwiIGNsYXNzPVwiZW1wdHktZGF0YVwiPlxyXG4gICAgICAgICAgPHNwYW4+Tm8gZGF0YTwvc3Bhbj5cclxuICAgICAgICAgIDxwPkNyZWF0ZSBmaXJzdCBkYXRhIG5vdyE8L3A+XHJcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3JlYXRlLWJ1dHRvbiBpbmxpbmUtZmxleCBpdGVtcy1jZW50ZXJcIj5cclxuICAgICAgICAgICAgPGkgY2xhc3M9XCJpY29uIGljb24tdm5scC1pY29uLWFkZC1saW5lYXJcIj48L2k+XHJcbiAgICAgICAgICAgIDxzcGFuPkNyZWF0ZTwvc3Bhbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvdGQ+XHJcbiAgICAgIDwvdHI+XHJcbiAgICA8L25nLXRlbXBsYXRlPlxyXG4gIDwvdGFibGU+XHJcbiAgPGRpdiAqbmdJZj1cInBhZ2VPcHRpb25zLnBhZ2luYXRpb25cIiBjbGFzcz1cInRhYmxlLWZvb3RlclwiPlxyXG4gICAgPHAgY2xhc3M9XCJjb3VudGVyXCI+e3sgZ2V0RGlzcGxheVRleHQoKSB9fTwvcD5cclxuICAgIDxkaXYgY2xhc3M9XCJwYWdpbmF0b3JcIj5cclxuICAgICAgPGJ1dHRvblxyXG4gICAgICAgIFtkaXNhYmxlZF09XCJwYWdlT3B0aW9ucy5jdXJyZW50UGFnZSA9PSAxXCJcclxuICAgICAgICAoY2xpY2spPVwicHJldlBhZ2UoKVwiXHJcbiAgICAgICAgY2xhc3M9XCJwYWdpbmF0b3ItcHJldiBpY29uIGljb24tdm5scC1pY29uLWFycm93LWxlZnQtMi1saW5lYXJcIlxyXG4gICAgICA+PC9idXR0b24+XHJcbiAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IHBhZ2VOdW1iZXIgb2YgcGFnZXNcIj5cclxuICAgICAgICA8YnV0dG9uXHJcbiAgICAgICAgICBjbGFzcz1cInBhZ2UtbnVtYmVyXCJcclxuICAgICAgICAgIFtjbGFzcy5hY3RpdmVdPVwicGFnZU51bWJlciA9PSBwYWdlT3B0aW9ucy5jdXJyZW50UGFnZVwiXHJcbiAgICAgICAgICAoY2xpY2spPVwiZ29Ub1BhZ2UocGFnZU51bWJlcilcIlxyXG4gICAgICAgID5cclxuICAgICAgICAgIHt7IHBhZ2VOdW1iZXIgfX1cclxuICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgPC9uZy1jb250YWluZXI+XHJcbiAgICAgIDxidXR0b25cclxuICAgICAgICBbZGlzYWJsZWRdPVwicGFnZU9wdGlvbnMuY3VycmVudFBhZ2UgPT0gbGFzdFBhZ2UgfHwgbGFzdFBhZ2UgPT09IDBcIlxyXG4gICAgICAgIChjbGljayk9XCJuZXh0UGFnZSgpXCJcclxuICAgICAgICBjbGFzcz1cInBhZ2luYXRvci1uZXh0IGljb24gaWNvbi12bmxwLWljb24tYXJyb3ctcmlnaHQtMy1saW5lYXJcIlxyXG4gICAgICA+PC9idXR0b24+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxuPC9kaXY+XHJcbiJdfQ==